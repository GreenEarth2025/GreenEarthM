<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Canberra P Mopuri Family Bill Tracker (Australian FY)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="color-scheme" content="dark light">
<style>
:root {
  --bg: #0b0f14;
  --panel: #121823;
  --muted: #93a1b3;
  --text: #e6edf3;
  --primary: #5dd3ff;
  --accent: #87ffa3;
  --warn: #ffd66b;
  --danger: #ff7b7b;
  --ok: #7dffa0;
  --info: #74b9ff;
  --grid: rgba(255,255,255,0.06);
  --chip: rgba(255,255,255,0.06);
  --shadow: 0 10px 30px rgba(0,0,0,0.35);
  --radius: 14px;
  /* Category colors */
  --cat-housing: #4da3ff;
  --cat-utilities: #ffe066;
  --cat-connectivity: #5dd3ff;
  --cat-insurance: #b084ff;
  --cat-subscriptions: #ff99cc;
  --cat-transport: #ffb366;
  --cat-health: #ff6666;
  --cat-family: #66ff99;
  --cat-other: #cccccc;
}
body {
  margin:0;
  font: 14px/1.45 system-ui, sans-serif;
  color: var(--text);
  background: var(--bg);
}
header {
  position: sticky; top: 0; z-index: 50;
  backdrop-filter: blur(10px);
  background: color-mix(in oklab, var(--bg) 85%, transparent);
  border-bottom: 1px solid var(--grid);
}
.wrap { max-width: 1150px; margin: 0 auto; padding: 18px; }
.row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
.grow { flex:1; min-width: 220px; }
h1 { margin:0; font-size: 20px; display:flex; align-items:center; gap:10px; }
.sub { color: var(--muted); font-weight: 500; }
.pill {
  display:inline-flex; align-items:center; gap:8px; padding:8px 10px;
  border-radius: 999px; background: var(--chip); color: var(--muted);
  border: 1px dashed var(--grid);
}
select, input[type="date"], input[type="text"], input[type="number"], textarea {
  background: var(--panel); color: var(--text); border: 1px solid var(--grid);
  padding: 10px 12px; border-radius: 10px; width: 100%;
}
.btn {
  background: var(--panel); color: var(--text);
  border: 1px solid var(--grid); padding: 10px 12px;
  border-radius: 10px; cursor: pointer;
}
.btn.primary { background: var(--primary); color: #000; }
.btn.warn { background: var(--warn); color: #000; }
.grid { display:grid; grid-template-columns: 1.2fr 1fr; gap: 16px; }
@media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }
.card {
  background: var(--panel); border: 1px solid var(--grid);
  border-radius: var(--radius); box-shadow: var(--shadow);
}
.card > .h {
  padding: 14px 16px; border-bottom: 1px solid var(--grid);
  display:flex; justify-content: space-between; align-items: center;
}
.card > .b { padding: 14px 16px; }
table { width:100%; border-collapse: separate; border-spacing: 0 8px; }
thead th {
  text-align:left; padding: 6px 8px; color: var(--muted);
  font-weight: 600; font-size: 12px; text-transform: uppercase;
}
tbody td {
  background: var(--panel); border-top: 1px solid var(--grid);
  border-bottom: 1px solid var(--grid); padding: 10px;
}
tbody tr td:first-child {
  border-left: 6px solid transparent;
}
tbody tr.housing td:first-child { border-color: var(--cat-housing); }
tbody tr.utilities td:first-child { border-color: var(--cat-utilities); }
tbody tr.connectivity td:first-child { border-color: var(--cat-connectivity); }
tbody tr.insurance td:first-child { border-color: var(--cat-insurance); }
tbody tr.subscriptions td:first-child { border-color: var(--cat-subscriptions); }
tbody tr.transport td:first-child { border-color: var(--cat-transport); }
tbody tr.health td:first-child { border-color: var(--cat-health); }
tbody tr.family td:first-child { border-color: var(--cat-family); }
tbody tr.other td:first-child { border-color: var(--cat-other); }
.category-icon { margin-right: 6px; }
.kpi { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
.k { background: var(--panel); border: 1px solid var(--grid); border-radius: 12px; padding: 12px; }
.k .label { color: var(--muted); }
.k .value { font-size: 20px; font-weight: 700; }
.k.clickable { cursor: pointer; transition: background 0.2s; }
.k.clickable:hover { background: var(--chip); }
@media print {
  body { background: var(--bg); color: var(--text); }
  header, .toolbar, dialog { display:none !important; }
}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div class="grow">
        <h1>Canberra Family Bill Tracker <span class="sub">(Australian FY)</span></h1>
        <div class="sub">Q1 = Jul‚ÄìSep, Q2 = Oct‚ÄìDec, Q3 = Jan‚ÄìMar, Q4 = Apr‚ÄìJun</div>
      </div>
      <div class="row">
        <label class="pill">
          <span>FY start:</span>
          <select id="fyYear"></select>
        </label>
        <label class="pill">
          <span>Quarter:</span>
          <select id="quarter">
            <option value="Q1">Q1</option>
            <option value="Q2">Q2</option>
            <option value="Q3">Q3</option>
            <option value="Q4">Q4</option>
            <option value="ALL">All</option>
          </select>
        </label>
        <span class="pill" id="today"></span>
      </div>
    </div>
  </div>
</header>
<main class="wrap">
  <div class="toolbar" style="margin-bottom:12px;">
    <button class="btn primary" id="addBtn">‚ûï Add New Bill</button>
    <button class="btn" id="exportBtn">‚¨áÔ∏è Export</button>
    <button class="btn" id="importBtn">‚¨ÜÔ∏è Import</button>
    <button class="btn warn" id="pdfBtn">üñ®Ô∏è Generate PDF Summary</button>
    <span class="pill">Currency: AUD</span>
  </div>
  <section class="grid">
    <div class="card">
      <div class="h"><span>Bill Stress Meter</span></div>
      <div class="b" id="stressMeter">[Stress meter will render here]</div>
    </div>
    <div class="card">
      <div class="h"><span>Quarter snapshot</span></div>
      <div class="b">
        <div class="kpi" id="categoryTotals"></div>
      </div>
    </div>
  </section>
  <section style="margin-top:16px;">
    <div class="card">
      <div class="h"><span>Bills</span></div>
      <div class="b">
        <table>
          <thead>
            <tr>
              <th>Status</th>
              <th>Category</th>
              <th>Bill</th>
              <th>Amount</th>
              <th>Required</th>
              <th>Due date</th>
              <th>Paid?</th>
              <th>Paid
                <script>
// ---------- Utilities ----------
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const fmtAUD = v => new Intl.NumberFormat('en-AU', { style:'currency', currency:'AUD' }).format(Number(v||0));
const toISO = d => d ? new Date(d).toISOString().slice(0,10) : "";
const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

function getFYStartYear(date){
  const m = new Date(date).getMonth();
  return (m >= 6) ? new Date(date).getFullYear() : new Date(date).getFullYear() - 1;
}
function getQuarter(date){
  const m = new Date(date).getMonth();
  if (m>=6 && m<=8) return 'Q1';
  if (m>=9 && m<=11) return 'Q2';
  if (m>=0 && m<=2) return 'Q3';
  return 'Q4';
}
function daysFromToday(date){
  const MS=86400000;
  const d = new Date(toISO(date));
  const t = new Date(toISO(new Date()));
  return Math.round((d - t)/MS);
}
function statusOf(bill){
  if (bill.paid) return 'PAID';
  const days = daysFromToday(bill.dueDate);
  if (days < 0) return 'OVERDUE';
  if (days <= 14) return 'SOON';
  return 'OUTSTANDING';
}
function categoryClass(cat){
  const map = {
    'Housing':'housing','Utilities':'utilities','Connectivity':'connectivity',
    'Insurance':'insurance','Subscriptions':'subscriptions','Transport':'transport',
    'Health':'health','Family':'family'
  };
  return map[cat] || 'other';
}
function categoryIcon(cat){
  const map = {
    'Housing':'üè†','Utilities':'üí°','Connectivity':'üåê','Insurance':'üõ°Ô∏è',
    'Subscriptions':'üì∫','Transport':'üöó','Health':'‚ù§Ô∏è','Family':'üë®‚Äçüë©‚Äçüëß'
  };
  return map[cat] || 'üì¶';
}

// ---------- Storage ----------
const KEY='canberra-bills-v3';
const store = {
  load(){ try { return JSON.parse(localStorage.getItem(KEY)) || { bills: [] }; } catch { return { bills: [] }; } },
  save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }
};

// ---------- State ----------
let data = store.load();
if (!data.bills.length){
  const baseFY = getFYStartYear(new Date());
  const y0 = baseFY, y1 = baseFY+1;
  const seed = [
    {q:'Q1', name:'Rent', cat:'Housing', amt:2300, req:true, due:new Date(y0,6,1)},
    {q:'Q1', name:'Electricity', cat:'Utilities', amt:210.5, req:true, due:new Date(y0,6,25)},
    {q:'Q1', name:'Water', cat:'Utilities', amt:95.3, req:true, due:new Date(y0,7,5)},
    {q:'Q1', name:'Internet', cat:'Connectivity', amt:79, req:true, due:new Date(y0,6,10)},
    {q:'Q1', name:'Mobile plan', cat:'Connectivity', amt:45, req:true, due:new Date(y0,7,15)},
    {q:'Q1', name:'Car rego', cat:'Transport', amt:620, req:true, due:new Date(y0,8,10)},
    {q:'Q1', name:'Gym', cat:'Health', amt:35, req:false, due:new Date(y0,7,3)},
    {q:'Q1', name:'Netflix', cat:'Subscriptions', amt:22.99, req:false, due:new Date(y0,7,12)},
    {q:'Q2', name:'Rent', cat:'Housing', amt:2300, req:true, due:new Date(y0,9,1)},
    {q:'Q2', name:'Gas', cat:'Utilities', amt:140, req:true, due:new Date(y0,9,18)},
    {q:'Q2', name:'Council rates', cat:'Housing', amt:550, req:true, due:new Date(y0,10,15)},
    {q:'Q2', name:'Internet', cat:'Connectivity', amt:79, req:true, due:new Date(y0,10,10)},
    {q:'Q2', name:'Spotify', cat:'Subscriptions', amt:18.99, req:false, due:new Date(y0,11,5)},
    {q:'Q2', name:'Home insurance', cat:'Insurance', amt:980, req:true, due:new Date(y0,11,20)},
    {q:'Q3', name:'Rent', cat:'Housing', amt:2350, req:true, due:new Date(y1,0,1)},
    {q:'Q3', name:'Electricity', cat:'Utilities', amt:225.4, req:true, due:new Date(y1,1,1)},
    {q:'Q3', name:'Water', cat:'Utilities', amt:90.7, req:true, due:new Date(y1,2,3)},
    {q:'Q3', name:'Internet', cat:'Connectivity', amt:79, req:true, due:new Date(y1,2,10)},
    {q:'Q3', name:'Car insurance', cat:'Insurance', amt:780, req:true, due:new Date(y1,1,14)},
    {q:'Q3', name:'Childcare fees', cat:'Family', amt:420, req:true, due:new Date(y1,1,7)},
    {q:'Q4', name:'Rent', cat:'Housing', amt:2350, req:true, due:new Date(y1,3,1)},
    {q:'Q4', name:'Gas', cat:'Utilities', amt:150, req:true, due:new Date(y1,4,12)},
    {q:'Q4', name:'Strata', cat:'Housing', amt:760, req:true, due:new Date(y1,4,20)},
    {q:'Q4', name:'Health insurance', cat:'Insurance', amt:265, req:true, due:new Date(y1,5,2)},
    {q:'Q4', name:'Internet', cat:'Connectivity', amt:79, req:true, due:new Date(y1,5,10)},
    {q:'Q4', name:'Amazon Prime', cat:'Subscriptions', amt:9.99, req:false, due:new Date(y1,5,15)}
  ];
  data.bills = seed.map(s => ({
    id: uid(),
    name: s.name,
    category: s.cat,
    amount: s.amt,
    required: s.req,
    paid: false,
    paidDate: '',
    paidBy: '',
    dueDate: toISO(s.due),
    notes: ''
  }));
  store.save(data);
}

// ---------- Rendering ----------
function renderTable(filterCat=null){
  const tbody = document.querySelector('#billTableBody');
  tbody.innerHTML = '';
  const fy = Number($('#fyYear').value);
  const q = $('#quarter').value;
  const bills = data.bills.filter(b => {
    const matchFY = getFYStartYear(b.dueDate) === fy;
    const matchQ = (q==='ALL') || (getQuarter(b.dueDate)===q);
    const matchCat = !filterCat || b.category===filterCat;
    return matchFY && matchQ && matchCat;
  });
  bills.forEach(b => {
    const tr = document.createElement('tr');
    tr.classList.add(categoryClass(b.category));
    tr.innerHTML = `
      <td>${statusOf(b)}</td>
      <td>${categoryIcon(b.category)} ${b.category}</td>
      <td>${b.name}</td>
      <td>${fmtAUD(b.amount)}</td>
      <td>${b.required?'Yes':'No'}</td>
      <td>${b.dueDate}</td>
      <td>${b.paid?'Yes':'No'}</td>
      <td>${b.paidBy||''}</td>
      <td>
        <button onclick="editBill('${b.id}')">‚úèÔ∏è</button>
        <button onclick="deleteBill('${b.id}')">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function renderCategoryTotals(){
  const container = $('#categoryTotals');
  container.innerHTML = '';
  const fy = Number($('#fyYear').value);
  const q = $('#quarter').value
 <script>
function renderCategoryTotals(){
  const container = $('#categoryTotals');
  container.innerHTML = '';
  const fy = Number($('#fyYear').value);
  const q = $('#quarter').value;
  const filtered = data.bills.filter(b => getFYStartYear(b.dueDate)===fy && (q==='ALL' || getQuarter(b.dueDate)===q));
  const totals = {};
  filtered.forEach(b => {
    totals[b.category] = (totals[b.category]||0) + Number(b.amount||0);
  });
  Object.entries(totals).forEach(([cat, total]) => {
    const div = document.createElement('div');
    div.className = 'k clickable';
    div.innerHTML = `<div class="label">${categoryIcon(cat)} ${cat}</div><div class="value">${fmtAUD(total)}</div>`;
    div.onclick = () => renderTable(cat);
    container.appendChild(div);
  });
}

function addBill(bill){
  data.bills.push(bill);
  store.save(data);
  refresh();
}
function editBill(id){
  const b = data.bills.find(x=>x.id===id);
  if (!b) return;
  const name = prompt('Bill name:', b.name);
  if (name===null) return;
  b.name = name;
  b.amount = parseFloat(prompt('Amount:', b.amount)) || b.amount;
  store.save(data);
  refresh();
}
function deleteBill(id){
  if (!confirm('Delete this bill?')) return;
  data.bills = data.bills.filter(b=>b.id!==id);
  store.save(data);
  refresh();
}

$('#addBtn').onclick = () => {
  const name = prompt('Bill name:');
  if (!name) return;
  const category = prompt('Category:');
  const amount = parseFloat(prompt('Amount:')) || 0;
  const dueDate = prompt('Due date (YYYY-MM-DD):', toISO(new Date()));
  const required = confirm('Required? OK=Yes, Cancel=No');
  addBill({id:uid(), name, category, amount, required, paid:false, paidDate:'', paidBy:'', dueDate, notes:''});
};

$('#exportBtn').onclick = () => {
  const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'bills.json';
  a.click();
};

$('#importBtn').onclick = () => {
  const json = prompt('Paste JSON here:');
  if (!json) return;
  try {
    const imported = JSON.parse(json);
    imported.bills.forEach(b => {
      if (!data.bills.find(x=>x.id===b.id)) data.bills.push(b);
    });
    store.save(data);
    refresh();
  } catch(e){ alert('Invalid JSON'); }
};

$('#pdfBtn').onclick = () => {
  const fy = Number($('#fyYear').value);
  const q = $('#quarter').value;
  const filtered = data.bills.filter(b => getFYStartYear(b.dueDate)===fy && (q==='ALL' || getQuarter(b.dueDate)===q));
  const grouped = {};
  filtered.forEach(b => {
    if (!grouped[b.category]) grouped[b.category] = [];
    grouped[b.category].push(b);
  });
  let html = `<h1>Bill Summary FY ${fy} ${q}</h1>`;
  let grandTotal = 0;
  for (const [cat, bills] of Object.entries(grouped)){
    const total = bills.reduce((a,b)=>a+Number(b.amount||0),0);
    grandTotal += total;
    html += `<h2>${categoryIcon(cat)} ${cat} ‚Äî ${fmtAUD(total)}</h2><ul>`;
    bills.forEach(b => {
      html += `<li>${b.name} ‚Äî ${fmtAUD(b.amount)} ‚Äî Due ${b.dueDate} ‚Äî ${b.paid?'Paid':'Unpaid'}</li>`;
    });
    html += `</ul>`;
  }
  html += `<h2>Grand Total: ${fmtAUD(grandTotal)}</h2>`;
  const w = window.open('', 'PrintWindow');
  w.document.write(`<html><head><title>PDF Summary</title></head><body style="background:${getComputedStyle(document.body).backgroundColor};color:${getComputedStyle(document.body).color};font-family:sans-serif;">${html}</body></html>`);
  w.document.close();
  w.print();
};

function refresh(){
  renderTable();
  renderCategoryTotals();
}

(function init(){
  const fySel = $('#fyYear');
  const yearNow = getFYStartYear(new Date());
  for (let y = yearNow-1; y <= yearNow+2; y++){
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = `FY ${y}-${String((y+1)%100).padStart(2,'0')}`;
    if (y===yearNow) opt.selected = true;
    fySel.appendChild(opt);
  }
  $('#quarter').value = getQuarter(new Date());
  $('#today').textContent = `Today: ${new Date().toLocaleDateString('en-AU',{weekday:'short', day:'2-digit', month:'short', year:'numeric'})}`;
  refresh();
})();
</script>
</body>
</html>

